<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Sanctuary Infinity</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #C2B280; --vanta: #050508; --white: #FFFFFF; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { background: var(--vanta); color: var(--gold); font-family: -apple-system, sans-serif; margin: 0; height: 100vh; overflow: hidden; }

        /* UNLOCK OVERLAY */
        #audio-unlocker { position: fixed; inset: 0; background: var(--vanta); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .unlock-btn { border: 1px solid var(--gold); padding: 15px 40px; border-radius: 30px; color: var(--gold); background: none; letter-spacing: 2px; cursor: pointer; }

        /* LAYOUT */
        .view-container { height: calc(100vh - 85px); display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .view-active { display: flex; }
        .header-title { letter-spacing: 8px; font-weight: 300; text-transform: uppercase; margin: 20px 0; font-size: 1.2rem; }

        /* TASBIH SVG */
        .tasbih-box { position: relative; width: 300px; height: 300px; display: flex; align-items: center; justify-content: center; }
        .tasbih-svg { position: absolute; inset: 0; transform: rotate(-90deg); width: 100%; height: 100%; }
        .circle-bg { fill: none; stroke: rgba(194, 178, 128, 0.1); stroke-width: 8; }
        .circle-prog { fill: none; stroke: var(--gold); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 816; stroke-dashoffset: 816; transition: stroke-dashoffset 0.1s linear; }
        .tasbih-num { font-size: 6rem; color: var(--white); font-weight: 100; margin: 0; user-select: none; }

        /* NAV */
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 85px; background: #08080a; border-top: 1px solid rgba(194,178,128,0.1); display: flex; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0.3; font-size: 0.6rem; text-transform: uppercase; }
        .nav-item.active { opacity: 1; }
        
        /* CELEBRATION */
        .star { position: absolute; color: var(--gold); pointer-events: none; animation: fall 2s linear forwards; }
        @keyframes fall { to { transform: translateY(100vh); opacity: 0; } }
    </style>
</head>
<body>

    <div id="audio-unlocker">
        <h2 style="font-weight: 100; letter-spacing: 5px; margin-bottom: 30px;">SANCTUARY</h2>
        <button class="unlock-btn" onclick="UnlockApp()">ENTER</button>
    </div>

    <div id="view-journey" class="view-container">
        <h1 class="header-title">The Journey</h1>
        <div style="text-align:center; margin-top:50px;">
            <p style="font-size:0.7rem; opacity:0.5; letter-spacing:2px;">LIFETIME COUNT</p>
            <p id="life-val" style="font-size:4rem; color:var(--white); font-weight:100;">0</p>
        </div>
    </div>

    <div id="view-tasbih" class="view-container view-active">
        <h1 class="header-title">Tasbih</h1>
        <div class="tasbih-box" id="tasbih-tap-zone">
            <svg class="tasbih-svg" viewBox="0 0 280 280">
                <circle class="circle-bg" cx="140" cy="140" r="130"></circle>
                <circle id="prog-ring" class="circle-prog" cx="140" cy="140" r="130"></circle>
            </svg>
            <p id="count-val" class="tasbih-num">0</p>
        </div>
        <button onclick="ResetTasbih()" style="margin-top:40px; background:none; border:1px solid rgba(194,178,128,0.2); color:var(--gold); padding:10px 30px; border-radius:30px; font-size:0.7rem;">RESET SESSION</button>
    </div>

    <div id="view-salah" class="view-container">
        <h1 class="header-title">Salah</h1>
        <p>Salah tracker loading...</p>
    </div>

    <div class="nav-bar">
        <div id="n-journey" class="nav-item" onclick="Go('journey')"><span>Journey</span></div>
        <div id="n-tasbih" class="nav-item active" onclick="Go('tasbih')"><span>Tasbih</span></div>
        <div id="n-salah" class="nav-item" onclick="Go('salah')"><span>Salah</span></div>
    </div>

    <script>
        // CORE STATE
        let state = {
            cur: parseInt(localStorage.getItem('t_cur')) || 0,
            life: parseInt(localStorage.getItem('t_life')) || 0
        };

        // AUDIO OBJECTS
        const sfxTap = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
        const sfxDone = new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3');

        function UnlockApp() {
            // Unlocks audio context on iOS by playing a silent moment
            sfxTap.play().then(() => { sfxTap.pause(); sfxTap.currentTime = 0; });
            sfxDone.play().then(() => { sfxDone.pause(); sfxDone.currentTime = 0; });
            document.getElementById('audio-unlocker').style.display = 'none';
        }

        function Go(id) {
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('view-active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('view-active');
            document.getElementById('n-'+id).classList.add('active');
            if(id === 'journey') document.getElementById('life-val').textContent = state.life;
        }

        const ring = document.getElementById('prog-ring');
        const countDisplay = document.getElementById('count-val');

        function UpdateUI() {
            countDisplay.textContent = state.cur;
            const offset = 816 - (state.cur / 100 * 816);
            ring.style.strokeDashoffset = offset;
            localStorage.setItem('t_cur', state.cur);
            localStorage.setItem('t_life', state.life);
        }

        function HandleTap() {
            state.cur++;
            state.life++;
            
            if(state.cur < 100) {
                sfxTap.currentTime = 0;
                sfxTap.play();
                UpdateUI();
            } else {
                sfxDone.currentTime = 0;
                sfxDone.play();
                UpdateUI();
                setTimeout(() => {
                    Celebrate();
                    state.cur = 0;
                    UpdateUI();
                }, 500);
            }
        }

        function ResetTasbih() {
            state.cur = 0;
            UpdateUI();
        }

        function Celebrate() {
            for(let i=0; i<30; i++) {
                const s = document.createElement('div');
                s.className = 'star'; s.innerHTML = 'â˜…';
                s.style.left = Math.random()*100+'vw';
                s.style.top = '-20px';
                document.body.appendChild(s);
                setTimeout(() => s.remove(), 2500);
            }
        }

        // Setup touch listeners for instant mobile response
        const zone = document.getElementById('tasbih-tap-zone');
        zone.addEventListener('touchend', (e) => {
            e.preventDefault();
            HandleTap();
        });
        // Desktop fallback
        zone.addEventListener('click', (e) => {
            if (!('ontouchstart' in window)) HandleTap();
        });

        // Initialize
        window.onload = UpdateUI;
    </script>
</body>
</html>
