<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sanctuary Infinity</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #C2B280; --vanta: #050508; --white: #FFFFFF; --dark-grey: #121214; --glass: rgba(194, 178, 128, 0.08); }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body { background: var(--vanta); color: var(--gold); font-family: -apple-system, sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        .view-container { flex: 1; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .view-active { display: flex; }
        .header-title { letter-spacing: 6px; font-weight: 300; text-transform: uppercase; margin-bottom: 20px; text-align: center; font-size: 1.5rem; color: var(--gold); }

        /* --- SALAH: THE JOBS DESIGN --- */
        .date-scroller { display: flex; gap: 15px; margin-bottom: 25px; width: 100%; overflow-x: auto; padding: 10px; scroll-snap-type: x mandatory; }
        .date-pill { 
            flex: 0 0 auto; padding: 10px 20px; border-radius: 20px; border: 1px solid rgba(194,178,128,0.2);
            font-size: 0.7rem; color: var(--gold); scroll-snap-align: center; transition: 0.3s;
        }
        .date-pill.active { background: var(--gold); color: var(--vanta); border-color: var(--gold); font-weight: bold; }

        .salah-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; }
        .salah-orb { 
            background: #0f0f12; height: 100px; border-radius: 25px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid rgba(255,255,255,0.03); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
        }
        .salah-orb.lit { 
            background: radial-gradient(circle at center, rgba(194,178,128,0.2) 0%, #0f0f12 100%);
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(194,178,128,0.1), inset 0 0 10px rgba(194,178,128,0.2);
        }
        .orb-name { font-size: 0.8rem; letter-spacing: 2px; color: var(--white); opacity: 0.4; transition: 0.3s; }
        .lit .orb-name { opacity: 1; text-shadow: 0 0 10px var(--gold); }

        /* --- PARTICLES & ANIMATION --- */
        .star { position: absolute; color: var(--gold); font-size: 20px; pointer-events: none; z-index: 100; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }

        /* --- NAV BAR --- */
        .nav-bar { height: 85px; background: #08080a; border-top: 1px solid rgba(194, 178, 128, 0.1); display: flex; justify-content: space-around; align-items: center; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { display: flex; flex-direction: column; align-items: center; opacity: 0.3; flex: 1; cursor: pointer; }
        .nav-item.active { opacity: 1; }
        .nav-label { font-size: 0.5rem; letter-spacing: 1px; text-transform: uppercase; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="view-salah" class="view-container">
        <h1 class="header-title">Salah</h1>
        <div class="date-scroller" id="date-scroller"></div>
        <div class="salah-grid" id="salah-grid"></div>
    </div>

    <div id="view-tasbih" class="view-container view-active">
        <h1 class="header-title">Tasbih</h1>
        </div>

    <div id="view-memorization" class="view-container">
        <h1 class="header-title">Memorization</h1>
        </div>

    <div class="nav-bar">
        <div id="n-journey" class="nav-item" onclick="Navigation.go('journey')"><span class="nav-label">Journey</span></div>
        <div id="n-tasbih" class="nav-item active" onclick="Navigation.go('tasbih')"><span class="nav-label">Tasbih</span></div>
        <div id="n-salah" class="nav-item" onclick="Navigation.go('salah')"><span class="nav-label">Salah</span></div>
        <div id="n-memorization" class="nav-item" onclick="Navigation.go('memorization')"><span class="nav-label">Memorization</span></div>
        <div id="n-recitation" class="nav-item" onclick="Navigation.go('recitation')"><span class="nav-label">Recitation</span></div>
    </div>

    <script>
        const Navigation = {
            go(id) {
                document.querySelectorAll('.view-container').forEach(v => v.classList.remove('view-active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('view-' + id).classList.add('view-active');
                document.getElementById('n-' + id).classList.add('active');
            }
        };

        const Effects = {
            stars() {
                for(let i=0; i<30; i++) {
                    const star = document.createElement('div');
                    star.className = 'star'; star.innerHTML = 'â˜…';
                    star.style.left = Math.random() * 100 + 'vw';
                    star.style.top = '-20px';
                    star.style.animationDuration = (Math.random() * 2 + 1) + 's';
                    document.body.appendChild(star);
                    setTimeout(() => star.remove(), 3000);
                }
            }
        };

        const Salah = {
            selectedDate: new Date().toDateString(),
            db: JSON.parse(localStorage.getItem('salah_db_v2')) || {},
            history: [],

            init() {
                // Generate last 3 days for scroller
                for(let i=0; i<3; i++) {
                    let d = new Date();
                    d.setDate(d.getDate() - i);
                    this.history.push(d.toDateString());
                }
                this.renderDates();
                this.renderGrid();
            },

            renderDates() {
                const scroller = document.getElementById('date-scroller');
                scroller.innerHTML = '';
                this.history.forEach(date => {
                    const pill = document.createElement('div');
                    pill.className = `date-pill ${this.selectedDate === date ? 'active' : ''}`;
                    pill.textContent = date === new Date().toDateString() ? 'TODAY' : date.split(' ').slice(0,3).join(' ');
                    pill.onclick = () => { this.selectedDate = date; this.renderDates(); this.renderGrid(); };
                    scroller.appendChild(pill);
                });
            },

            toggle(id) {
                if(!this.db[this.selectedDate]) this.db[this.selectedDate] = {};
                this.db[this.selectedDate][id] = !this.db[this.selectedDate][id];
                
                // Vibration feedback
                if(navigator.vibrate) navigator.vibrate(20);

                // Celebration Logic
                if(this.selectedDate === new Date().toDateString()) {
                    this.checkCelebration();
                }

                localStorage.setItem('salah_db_v2', JSON.stringify(this.db));
                this.renderGrid();
            },

            checkCelebration() {
                const today = this.db[this.selectedDate];
                const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                const allDone = prayers.every(p => today[p] === true);
                const hasCelebrated = localStorage.getItem('salah_cele_date') === this.selectedDate;

                if(allDone && !hasCelebrated) {
                    setTimeout(() => Effects.stars(), 400);
                    localStorage.setItem('salah_cele_date', this.selectedDate);
                }
            },

            renderGrid() {
                const grid = document.getElementById('salah-grid');
                grid.innerHTML = '';
                const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                const dayData = this.db[this.selectedDate] || {};

                prayers.forEach(p => {
                    const orb = document.createElement('div');
                    orb.className = `salah-orb ${dayData[p] ? 'lit' : ''}`;
                    orb.onclick = () => this.toggle(p);
                    orb.innerHTML = `<span class="orb-name">${p}</span>`;
                    grid.appendChild(orb);
                });
            }
        };

        // Initialize
        Salah.init();
    </script>
</body>
</html>
