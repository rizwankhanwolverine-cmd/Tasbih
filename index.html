<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sanctuary Infinity</title>
    <style>
        :root { --gold: #C2B280; --vanta: #050508; --white: #FFFFFF; --dark-grey: #121214; }
        * { -webkit-tap-highlight-color: transparent; outline: none; box-sizing: border-box; }

        body { 
            background-color: var(--vanta); color: var(--gold); 
            font-family: -apple-system, system-ui, sans-serif; 
            margin: 0; padding: 0; overflow: hidden; height: 100vh;
            display: flex; flex-direction: column;
        }

        .page { display: none; flex-direction: column; align-items: center; height: calc(100vh - 85px); width: 100%; padding: 20px; overflow-y: auto; }
        .active-page { display: flex; }

        .header-title { letter-spacing: 5px; font-weight: 200; text-transform: uppercase; margin-bottom: 15px; text-align: center; font-size: 1.1rem; }
        
        /* QURAN READER UI */
        .quran-container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 12px; }
        .controls-row { display: flex; gap: 8px; width: 100%; }
        .selector { background: var(--dark-grey); color: var(--gold); border: 1px solid rgba(194,178,128,0.2); padding: 10px; border-radius: 10px; flex: 1; font-size: 0.75rem; }
        
        .memo-box { background: rgba(194,178,128,0.05); padding: 10px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; gap: 10px; border: 1px dashed rgba(194,178,128,0.2); }
        .memo-input { background: transparent; border: 1px solid var(--gold); color: var(--white); width: 45px; text-align: center; border-radius: 5px; font-size: 0.8rem; padding: 2px; }

        .reader-frame { 
            background: #0a0a0c; padding: 25px 20px; border-radius: 20px; 
            text-align: center; border: 1px solid rgba(194, 178, 128, 0.1);
            min-height: 300px; display: flex; flex-direction: column; justify-content: center; position: relative;
        }
        .arabic-text { font-size: 1.8rem; line-height: 2.2; color: var(--white); direction: rtl; margin-bottom: 15px; }
        .trans-text { font-size: 0.85rem; color: var(--gold); opacity: 0.7; line-height: 1.5; min-height: 40px; }

        .audio-controls { display: flex; justify-content: space-around; align-items: center; margin-top: 15px; background: rgba(194,178,128,0.1); padding: 12px; border-radius: 50px; }
        .ctrl-btn { background: none; border: none; fill: var(--gold); cursor: pointer; width: 35px; height: 35px; display: flex; justify-content: center; align-items: center; }
        .play-pause { width: 50px; height: 50px; background: var(--gold); border-radius: 50%; fill: var(--vanta); }
        .repeat-btn { border-radius: 50%; width: 35px; height: 35px; border: 1px solid var(--gold); font-size: 0.6rem; font-weight: bold; }
        .repeat-btn.active { background: var(--gold); color: var(--vanta); }

        /* NAV BAR (Fixed at bottom) */
        .nav-bar { height: 85px; background: #08080a; border-top: 1px solid rgba(194, 178, 128, 0.1); display: flex; justify-content: space-around; align-items: center; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { display: flex; flex-direction: column; align-items: center; opacity: 0.25; transition: 0.3s; }
        .nav-item.active { opacity: 1; }
        .nav-icon-svg { width: 22px; height: 22px; fill: var(--gold); margin-bottom: 4px; }
        .nav-label { font-size: 0.5rem; letter-spacing: 1px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="page-quran" class="page active-page">
        <h1 class="header-title">Memorization</h1>
        <div class="quran-container">
            <div class="controls-row">
                <select id="surahSelect" class="selector" onchange="initSurah()">
                    <option value="1">1. Al-Fatiha</option>
                    <option value="2">2. Al-Baqarah</option>
                    <option value="112">112. Al-Ikhlas</option>
                    <option value="113">113. Al-Falaq</option>
                    <option value="114">114. Al-Nas</option>
                </select>
                <select id="langSelect" class="selector" onchange="updateVerseUI()">
                    <option value="en">English</option>
                    <option value="ur">Urdu</option>
                </select>
            </div>

            <div class="memo-box">
                <span style="font-size: 0.6rem; letter-spacing: 1px;">LOOP RANGE:</span>
                <div>
                    <input type="number" id="loopFrom" class="memo-input" value="1" min="1" onchange="validateLoop()">
                    <span style="font-size: 0.8rem;">to</span>
                    <input type="number" id="loopTo" class="memo-input" value="7" min="1" onchange="validateLoop()">
                </div>
                <button id="repeatBtn" class="repeat-btn" onclick="toggleRepeat()">LOOP</button>
            </div>
            
            <div class="reader-frame">
                <div id="v-num" style="font-size: 0.6rem; opacity: 0.4; margin-bottom: 10px; letter-spacing: 2px;">VERSE 1</div>
                <div id="q-arabic" class="arabic-text">...</div>
                <div id="q-trans" class="trans-text">...</div>
                
                <div class="audio-controls">
                    <button class="ctrl-btn" onclick="prevVerse()">
                        <svg viewBox="0 0 24 24" width="24"><path d="M6,18L14.5,12L6,6V18M16,6V18H18V6H16Z" transform="rotate(180 12 12)"/></svg>
                    </button>
                    <button id="playBtn" class="ctrl-btn play-pause" onclick="toggleAudio()">
                        <svg id="playIcon" viewBox="0 0 24 24" width="24"><path d="M8,5.14V19.14L19,12.14L8,5.14Z"/></svg>
                    </button>
                    <button class="ctrl-btn" onclick="nextVerse()">
                        <svg viewBox="0 0 24 24" width="24"><path d="M6,18L14.5,12L6,6V18M16,6V18H18V6H16Z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item" onclick="location.reload()"><svg class="nav-icon-svg" viewBox="0 0 24 24"><path d="M12,2A3,3 0 0,1 15,5A3,3 0 0,1 12,8A3,3 0 0,1 9,5A3,3 0 0,1 12,2M12,16A3,3 0 0,1 15,19A3,3 0 0,1 12,22A3,3 0 0,1 9,19A3,3 0 0,1 12,16M18,8A3,3 0 0,1 21,11A3,3 0 0,1 18,14A3,3 0 0,1 15,11A3,3 0 0,1 18,8M6,8A3,3 0 0,1 9,11A3,3 0 0,1 6,14A3,3 0 0,1 3,11A3,3 0 0,1 6,8Z"/></svg><span class="nav-label">Beads</span></div>
        <div class="nav-item active"><svg class="nav-icon-svg" viewBox="0 0 24 24"><path d="M12,11.5L19,7V18L12,22.5L5,18V7L12,11.5M12,2L19,6L12,10L5,6L12,2Z"/></svg><span class="nav-label">Quran</span></div>
        <div class="nav-item"><svg class="nav-icon-svg" viewBox="0 0 24 24"><path d="M12,2L14.5,8.5L21,9.25L16.25,13.75L17.5,20.25L12,17.25L6.5,20.25L7.75,13.75L3,9.25L9.5,8.5L12,2M12,19V22H2V20H22V22H12V19Z"/></svg><span class="nav-label">Journey</span></div>
    </div>

    <audio id="mainAudio" onended="handleAudioEnd()"></audio>

    <script>
        let currentSurah = 1;
        let currentVerse = 1;
        let totalVerses = 7;
        let verseData = [];
        let isRepeat = false;
        const audioPlayer = document.getElementById('mainAudio');

        async function initSurah() {
            currentSurah = document.getElementById('surahSelect').value;
            currentVerse = 1;
            pauseAudio();
            
            const [resAr, resEn, resUr] = await Promise.all([
                fetch(`https://api.alquran.cloud/v1/surah/${currentSurah}`),
                fetch(`https://api.alquran.cloud/v1/surah/${currentSurah}/en.sahih`),
                fetch(`https://api.alquran.cloud/v1/surah/${currentSurah}/ur.jalandhry`)
            ]);

            const dataAr = await resAr.json();
            const dataEn = await resEn.json();
            const dataUr = await resUr.json();

            totalVerses = dataAr.data.numberOfAyahs;
            document.getElementById('loopTo').value = totalVerses;
            document.getElementById('loopTo').max = totalVerses;
            document.getElementById('loopFrom').max = totalVerses;

            verseData = dataAr.data.ayahs.map((ayah, i) => ({
                ar: ayah.text,
                en: dataEn.data.ayahs[i].text,
                ur: dataUr.data.ayahs[i].text,
                audio: `https://cdn.islamic.network/quran/audio/128/ar.alafasy/${ayah.number}.mp3`
            }));

            updateVerseUI();
        }

        function updateVerseUI() {
            const verse = verseData[currentVerse - 1];
            const lang = document.getElementById('langSelect').value;
            document.getElementById('v-num').textContent = `VERSE ${currentVerse} / ${totalVerses}`;
            document.getElementById('q-arabic').textContent = verse.ar;
            document.getElementById('q-trans').textContent = verse[lang];
            audioPlayer.src = verse.audio;
        }

        function toggleRepeat() {
            isRepeat = !isRepeat;
            document.getElementById('repeatBtn').classList.toggle('active', isRepeat);
        }

        function validateLoop() {
            let from = parseInt(document.getElementById('loopFrom').value);
            let to = parseInt(document.getElementById('loopTo').value);
            if (from < 1) from = 1;
            if (to > totalVerses) to = totalVerses;
            if (from > to) from = to;
            document.getElementById('loopFrom').value = from;
            document.getElementById('loopTo').value = to;
        }

        function handleAudioEnd() {
            const from = parseInt(document.getElementById('loopFrom').value);
            const to = parseInt(document.getElementById('loopTo').value);

            if (isRepeat) {
                if (currentVerse >= to) {
                    currentVerse = from; // Back to start of loop
                } else {
                    currentVerse++;
                }
                updateVerseUI();
                playAudio();
            } else {
                if (currentVerse < totalVerses) nextVerse();
                else pauseAudio();
            }
        }

        function toggleAudio() {
            if (audioPlayer.paused) playAudio();
            else pauseAudio();
        }

        function playAudio() { audioPlayer.play(); document.getElementById('playIcon').innerHTML = '<path d="M14,19H18V5H14M6,19H10V5H6V19Z"/>'; }
        function pauseAudio() { audioPlayer.pause(); document.getElementById('playIcon').innerHTML = '<path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>'; }

        function nextVerse() { if (currentVerse < totalVerses) { currentVerse++; updateVerseUI(); playAudio(); } }
        function prevVerse() { if (currentVerse > 1) { currentVerse--; updateVerseUI(); playAudio(); } }

        initSurah();
    </script>
</body>
</html>
