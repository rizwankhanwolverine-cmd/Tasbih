<!DOCTYPE html>
<html>
<head>
    <style>
        body { background: #050508; color: #C2B280; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; -webkit-user-select: none; user-select: none; }
        .tasbih-display { position: relative; width: 280px; height: 280px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        #t-num { font-size: 7rem; color: white; font-weight: 200; }
        circle { transition: 0.15s; stroke-linecap: round; }
        
        /* The Unlock Overlay */
        #audio-unlocker { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(5,5,8,0.95); z-index: 999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            cursor: pointer;
        }
        .unlock-icon { font-size: 3rem; margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body onclick="beedHit()">

    <audio id="beed-sfx" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" type="audio/mpeg">
    </audio>

    <div id="audio-unlocker" onclick="initAudio(event)">
        <div class="unlock-icon">ðŸ””</div>
        <div style="letter-spacing:3px; font-weight:bold; font-size:0.8rem;">TAP TO ACTIVATE SOUND</div>
    </div>

    <div style="font-size:0.7rem; opacity:0.5; letter-spacing:2px; margin-bottom:10px;">DAILY BEEDS: <span id="t-today" style="color:white">0</span></div>
    
    <div class="tasbih-display">
        <svg style="position:absolute; width:100%; height:100%; transform:rotate(-90deg);" viewBox="0 0 260 260">
            <circle fill="none" stroke="rgba(194,178,128,0.1)" stroke-width="6" cx="130" cy="130" r="115"></circle>
            <circle id="ring" fill="none" stroke="#C2B280" stroke-width="6" stroke-dasharray="722" stroke-dashoffset="722" cx="130" cy="130" r="115"></circle>
        </svg>
        <div id="t-num">0</div>
    </div>
    
    <button onclick="event.stopPropagation(); reset();" style="margin-top:30px; background:none; border:1px solid rgba(194,178,128,0.2); color:#C2B280; padding:10px 20px; border-radius:10px; font-size:0.6rem; cursor:pointer;">RESET CYCLE</button>

    <script>
        let count = parseInt(localStorage.getItem('t_cur')) || 0;
        let today = parseInt(localStorage.getItem('t_today')) || 0;
        const sfx = document.getElementById('beed-sfx');
        let isUnlocked = false;

        // CRITICAL: This function runs on the first click and "blesses" the audio
        function initAudio(e) {
            e.stopPropagation();
            sfx.play().then(() => {
                sfx.pause();
                sfx.currentTime = 0;
                isUnlocked = true;
                document.getElementById('audio-unlocker').style.display = 'none';
            }).catch(err => {
                console.log("Audio still locked by browser");
            });
        }

        function beedHit() {
            if (isUnlocked) {
                sfx.currentTime = 0;
                sfx.play();
            }
            
            count++; today++;
            if(count >= 10) {
                window.parent.postMessage('celebrate', '*');
                count = 0;
            }
            save();
        }

        function reset() { count = 0; save(); }
        function save() {
            document.getElementById('t-num').textContent = count;
            document.getElementById('t-today').textContent = today;
            document.getElementById('ring').style.strokeDashoffset = 722 - (count / 10 * 722);
            localStorage.setItem('t_cur', count);
            localStorage.setItem('t_today', today);
        }
        save();
    </script>
</body>
</html>
